<html>
    <head>
        <title>Jungle Escape</title>

        <script type="text/javascript" src="storyLine.js"></script>

        <style>
            .test {
                margin: 50px;
                padding: 20px;
                border: solid black 5px;
            }

            .popup {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: #ffffff;
            padding: 20px;
            border: 1px solid #cccccc;
            box-shadow: 0px 0px 10px #aaaaaa;
            z-index: 9999;
            border-radius: 10px;
            }


            #notebook {
                width: 300px;
            }

            #note-input {
                width: 100%;
                height: 100px;
            }

            #notes-list {
                list-style-type: none;
                padding: 0;
            }

            .note-item {
                background-color: #f1f1f1;
                padding: 5px;
                margin-bottom: 5px;
                cursor: pointer;
            }

            .note-item:hover {
                background-color: #ddd;
            }

            .popup-overlay {
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background-color: rgba(0, 0, 0, 0.5);
                z-index: 1000;
            }

            .popup-content {
                position: fixed;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                background-color: #fff;
                padding: 20px;
                border-radius: 5px;
                z-index: 9999;
            }

            #accessibility-panel {
                position: fixed;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                background-color: #fff;
                padding: 20px;
                border-radius: 5px;
                z-index: 1001;
            }
        </style>
    </head>
    <body>
        <button onclick="showPopup()">NoteBook</button>
        <div class="popup" id="popup">
            <h2>Notebook</h2>
            <textarea id="note-input" placeholder="Write your note here..."></textarea>
            <button id="save-note-button">Save Note</button>
            <ul id="notes-list"></ul>
            <button onclick="hidePopup()">Close Popup</button>
        </div>
        <button id="open-accessibility-panel">Accessibility</button>

        <div id="accessibility-panel" style="display: none;">
            <h2>Accessibility Options</h2>
            <label for="text-size">Text Size:</label>
            <input type="range" id="text-size" min="14" max="24" value="16">
            <label for="text-color">Text Color:</label>
            <input type="color" id="text-color" value="#000000">
            <label for="background-color">Background Color:</label>
            <input type="color" id="background-color" value="#808080">
            <label for="font-select">Font:</label>
            <select id="font-select">
                <option value="Arial">Arial</option>
                <option value="Verdana">Verdana</option>
                <option value="OpenDyslexic">OpenDyslexic</option>
            </select>
            <button id="close-accessibility-panel">Close</button>
        </div>

        <button onclick="reset()">reset</button>
        <div id="wrapper">

            <div id="leftCol">

                <div id="timerBox" class="test">
                    <h1>timerBox</h1>
                    <p id="timeLeft"></p>
                </div>
    
                <div id="imageBox" class="test">
                    <h1>imageBox</h1>
                    <img src="" alt="" id="sceneImage">
                </div>

            </div>
        
            <div id="rightCol">

                <div id="descriptionBox"  class="test">
                    <h1>descriptionBox</h1>
                    <p id="sceneText"></p>
                </div>
    
                <div id="promptBox" class="test">
                    <h1>promptBox</h1>
                </div>

            </div>
        
        </div>

        <script type="text/javascript" src="popups.js"></script>

        <script>
            // get character customisation
            // sessionStorage.getItem('sceplayerNameneID');
            // sessionStorage.getItem('playerHairColour');
            // sessionStorage.getItem('playerHeight');

            // game logic
            setUpScene();

            function reset() {
                sceneID = "start";
                sessionStorage.setItem('sceneID',sceneID);
                setUpScene();
            }

            function setUpScene() {
                sceneID = sessionStorage.getItem('sceneID');
                if (sceneID === null) {
                    sceneID = "start";
                    sessionStorage.setItem('sceneID',sceneID);
                }
                sceneDict = storyLine[sceneID];
                console.log(sceneDict);
                if (sceneDict === undefined) {
                    if (sceneID == "stats") {
                        //go to stats page
                    }
                    alert("you've the dead end in the story, let Will know how you reached it")
                } else {
                    setElementsOnPage(sceneDict);
                }
            }

            function setElementsOnPage(sceneDict) {
                //clear prompts
                clearPrompts();

                //set image
                updateImage(sceneDict);

                //set description
                updateText(sceneDict);

                //set prompts
                updatePrompts(sceneDict);
                
                
            }

            function buttonClick(event){
                console.log(event.target.choiceNumber);
                choiceNumber = event.target.choiceNumber;
                console.log("a button was clicked");

                sceneID = sessionStorage.getItem('sceneID');

                sceneDict = storyLine[sceneID];
                console.log(sceneDict);
                choices = sceneDict.choices;

                choice = choices[choiceNumber];
                console.log(choice);
                next = choice.next;
                if (Array.isArray(next)) {
                    //run API here
                    next = next[0]; //remove later
                }
                sessionStorage.setItem('sceneID',next);
                setUpScene();
                
                
            }

            function clearPrompts() {
                promptBox = document.getElementById("promptBox");
                promptBox.innerHTML = null;
            }

            function updateImage(sceneDict) {
                //set image
                imgPath = sceneDict.image;
                document.getElementById("sceneImage").src = imgPath;
            }

            function updateText(sceneDict) {
                text = sceneDict.text;

                if (Array.isArray(text)) {
                    //run API here
                    text = text[0]; //remove later
                }

                document.getElementById("sceneText").innerHTML = text;
            }

            function updatePrompts(sceneDict) {
                choices = sceneDict.choices;
                promptBox = document.getElementById("promptBox");

                choices.forEach((element, index) => {
                    let choiceDiv = document.createElement("div");
                    choiceDiv.classList.add("choice");
                    let button = document.createElement("button");
                    button.type = "button";
                    button.innerHTML = element.emoji;
                    button.onclick = buttonClick;
                    button.choiceNumber = index;
                    console.log(element.emoji);
                    choiceDiv.appendChild(button);
                    let choiceText = document.createElement("p");
                    choiceText.innerHTML = element.text;
                    choiceDiv.appendChild(choiceText);
                    promptBox.appendChild(choiceDiv);
                });
            }

            // timer logic
            //timer related variables and event listener
            window.addEventListener('load', startTimer);
            var timeLeft = 60; //default amount
            var timer

            //timer methods

            function getInitialTime() {
                difficulty = sessionStorage.getItem('difficulty');

                switch(difficulty) {
                    case "easy":
                        timeLeft = 240;
                        break;
                    case "medium":
                        timeLeft = 120;
                        break;
                    case "hard":
                        timeLeft = 45
                        break;
                    default:
                        timeLeft = 120;
                }
                return timeLeft;
            }

            function startTimer() {
                timeLeft = getInitialTime();
                document.getElementById('timeLeft').innerHTML = timeLeft;
                timer = setInterval(decreaseTime, 1000);
            }

            function decreaseTime() {
                if (timeLeft>0) {
                    timeLeft--;
                    document.getElementById('timeLeft').innerHTML = timeLeft;
                } else {
                    clearInterval(timer);
                    document.getElementById('timeLeft').innerHTML = 'Time Up';
                    //add method here to be taken to end screen with indication that time ran out.
                }
            }
        </script>

    </body>
</html>